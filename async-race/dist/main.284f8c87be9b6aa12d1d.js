(()=>{"use strict";var t;!function(t){t[t.Success=200]="Success",t[t.NotFound=404]="NotFound"}(t||(t={}));const e=t=>`\n  <?xml version="1.0" standalone="no"?>\n  <svg class="car__image" version="1.0" xmlns="http://www.w3.org/2000/svg"\n   width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"\n   preserveAspectRatio="xMidYMid meet">\n  <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"\n  fill="${t}" stroke="none">\n  <path d="M3565 5336 c-106 -30 -101 -26 -108 -111 -4 -42 -9 -80 -12 -85 -6\n  -10 -246 -105 -590 -234 -448 -167 -1052 -415 -1173 -483 -78 -43 -193 -91\n  -250 -104 -23 -5 -98 -14 -165 -19 -67 -6 -167 -19 -222 -30 -154 -31 -340\n  -49 -563 -57 l-203 -6 -43 -66 c-59 -91 -60 -95 -26 -130 37 -37 38 -65 3\n  -150 -25 -62 -27 -78 -31 -256 l-4 -190 -38 -32 c-91 -78 -133 -209 -134 -418\n  0 -194 11 -396 26 -482 13 -71 14 -74 72 -122 69 -58 130 -129 158 -184 64\n  -126 534 -211 1384 -250 l92 -4 -6 119 c-6 142 8 256 49 383 112 352 394 622\n  756 722 90 26 112 28 278 28 165 0 188 -2 278 -27 201 -56 361 -152 504 -302\n  140 -145 222 -293 274 -492 21 -79 24 -109 23 -279 -1 -127 -6 -214 -16 -263\n  l-15 -73 3006 7 c1653 4 3007 8 3009 9 1 1 -8 37 -20 81 -19 67 -22 105 -22\n  259 -1 166 1 187 27 279 117 421 467 736 885 797 119 17 325 7 432 -21 239\n  -63 453 -205 601 -399 70 -92 154 -267 185 -386 24 -88 27 -119 27 -260 1\n  -116 -4 -181 -16 -234 -10 -41 -16 -75 -15 -76 2 -1 62 2 133 6 266 16 458 45\n  525 79 48 24 97 81 127 146 l24 52 -16 157 c-15 152 -15 163 4 284 63 388 50\n  680 -35 802 -134 193 -526 336 -1429 519 -737 149 -1322 209 -2033 210 -228 0\n  -226 0 -347 85 -187 131 -1045 607 -1471 815 -383 187 -788 281 -1439 332\n  -208 17 -1106 16 -1400 0 -121 -7 -314 -19 -430 -27 -302 -22 -286 -22 -341\n  10 -140 81 -187 94 -269 71z m1885 -333 c6 -37 38 -238 71 -446 32 -209 66\n  -422 75 -474 9 -52 15 -96 13 -97 -11 -9 -1699 29 -1951 44 -206 13 -417 36\n  -485 54 -98 26 -198 119 -249 231 -35 75 -36 172 -5 255 17 45 30 61 68 86 83\n  54 135 80 253 127 341 136 858 230 1460 267 269 16 270 16 511 18 l227 2 12\n  -67z m630 47 c264 -18 777 -110 1029 -186 186 -56 445 -188 756 -387 211 -134\n  274 -181 250 -185 -75 -12 -133 -50 -162 -106 -19 -35 -21 -136 -4 -179 l11\n  -27 -907 2 -906 3 -59 160 c-110 302 -298 878 -298 916 0 6 95 2 290 -11z"/>\n  <path d="M2633 3125 c-223 -40 -410 -141 -568 -306 -132 -138 -213 -283 -262\n  -467 -22 -83 -26 -119 -26 -247 -1 -169 10 -236 65 -382 87 -230 271 -436 493\n  -551 85 -44 178 -78 271 -98 107 -23 312 -23 419 1 392 84 699 375 802 761 23\n  86 26 120 27 254 1 158 -5 199 -46 330 -98 310 -355 567 -668 669 -150 50\n  -354 64 -507 36z m350 -301 c249 -56 457 -247 543 -499 25 -72 28 -95 28 -220\n  1 -153 -15 -228 -74 -345 -94 -186 -283 -337 -485 -386 -96 -24 -268 -24 -360\n  0 -320 84 -544 355 -562 681 -20 359 209 673 558 765 94 24 253 26 352 4z"/>\n  <path d="M2600 2697 c-36 -13 -85 -36 -109 -51 l-44 -28 116 -115 c81 -82 120\n  -114 131 -110 14 6 16 29 16 167 0 186 6 178 -110 137z"/>\n  <path d="M2920 2561 c0 -139 2 -162 16 -168 11 -4 50 28 130 108 l115 114 -28\n  22 c-34 28 -138 70 -193 79 l-40 7 0 -162z"/>\n  <path d="M2282 2448 c-28 -36 -92 -191 -92 -225 0 -10 34 -13 165 -13 151 0\n  165 1 165 18 0 15 -206 232 -221 232 -4 0 -11 -6 -17 -12z"/>\n  <path d="M3222 2351 c-62 -59 -112 -115 -112 -124 0 -15 17 -17 165 -17 131 0\n  165 3 165 13 0 40 -69 205 -95 227 -7 6 -48 -27 -123 -99z"/>\n  <path d="M2781 2332 c-12 -22 11 -62 34 -62 8 0 21 10 29 22 20 28 4 58 -29\n  58 -13 0 -29 -8 -34 -18z"/>\n  <path d="M2749 2161 c-32 -33 -37 -67 -14 -110 29 -57 104 -64 151 -14 53 57\n  9 153 -71 153 -27 0 -44 -8 -66 -29z"/>\n  <path d="M2570 2125 c-26 -32 13 -81 48 -59 24 16 27 45 6 61 -23 17 -39 16\n  -54 -2z"/>\n  <path d="M3006 2124 c-20 -19 -20 -38 -2 -54 23 -19 61 -8 64 18 7 44 -32 67\n  -62 36z"/>\n  <path d="M2190 1975 c0 -29 41 -140 72 -194 l31 -53 117 117 c71 71 116 123\n  113 131 -4 11 -40 14 -169 14 -141 0 -164 -2 -164 -15z"/>\n  <path d="M3110 1972 c0 -9 51 -68 114 -131 l114 -114 31 54 c30 51 71 165 71\n  195 0 11 -31 14 -165 14 -151 0 -165 -1 -165 -18z"/>\n  <path d="M2780 1901 c-7 -15 -5 -24 8 -41 32 -40 85 -4 62 41 -14 25 -56 25\n  -70 0z"/>\n  <path d="M2562 1697 c-61 -62 -112 -115 -112 -119 0 -18 208 -108 249 -108 7\n  0 11 54 11 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115 -113z"/>\n  <path d="M2933 1803 c-15 -6 -19 -333 -4 -333 46 0 251 88 251 108 0 9 -223\n  232 -230 231 -3 0 -11 -3 -17 -6z"/>\n  <path d="M10700 3119 c-390 -84 -696 -376 -797 -759 -31 -117 -41 -292 -24\n  -411 33 -227 150 -453 318 -609 267 -250 643 -344 993 -249 117 32 283 118\n  380 196 487 396 518 1128 67 1560 -97 93 -166 140 -290 198 -137 64 -235 86\n  -407 91 -120 3 -162 0 -240 -17z m445 -313 c238 -81 409 -258 486 -506 30 -96\n  33 -289 5 -388 -110 -400 -513 -637 -911 -536 -149 38 -313 147 -402 267 -176\n  238 -203 533 -71 797 34 69 60 103 138 180 77 78 111 104 181 139 129 65 207\n  81 364 77 109 -3 143 -7 210 -30z"/>\n  <path d="M10703 2700 c-54 -19 -153 -71 -153 -80 0 -3 51 -57 114 -119 80 -80\n  119 -112 130 -108 14 5 16 29 16 167 l0 160 -27 -1 c-16 0 -52 -9 -80 -19z"/>\n  <path d="M11020 2561 c0 -139 2 -162 16 -168 22 -8 247 216 234 232 -17 20\n  -163 84 -207 91 l-43 7 0 -162z"/>\n  <path d="M10366 2424 c-29 -44 -76 -165 -76 -194 0 -19 7 -20 165 -20 126 0\n  165 3 165 13 0 7 -51 63 -114 126 l-114 114 -26 -39z"/>\n  <path d="M11313 2348 c-61 -62 -109 -119 -106 -125 6 -15 333 -19 333 -4 0 45\n  -88 241 -108 241 -4 0 -57 -51 -119 -112z"/>\n  <path d="M10882 2338 c-17 -17 -15 -32 7 -52 16 -14 23 -15 41 -6 31 17 24 64\n  -10 68 -14 2 -31 -3 -38 -10z"/>\n  <path d="M10846 2159 c-68 -81 17 -194 110 -144 89 48 56 175 -46 175 -30 0\n  -44 -6 -64 -31z"/>\n  <path d="M10670 2126 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n  -54 2z"/>\n  <path d="M11106 2127 c-21 -16 -18 -45 7 -61 37 -23 77 35 41 61 -10 7 -21 13\n  -24 13 -3 0 -14 -6 -24 -13z"/>\n  <path d="M10290 1970 c0 -29 43 -141 74 -195 l28 -48 116 116 c81 81 113 120\n  109 131 -6 14 -29 16 -167 16 -152 0 -160 -1 -160 -20z"/>\n  <path d="M11207 1978 c-3 -7 47 -66 111 -130 l116 -118 27 43 c27 44 79 177\n  79 203 0 12 -28 14 -164 14 -122 0 -166 -3 -169 -12z"/>\n  <path d="M10881 1901 c-14 -25 -5 -48 20 -56 27 -9 51 13 47 44 -4 34 -51 43\n  -67 12z"/>\n  <path d="M10662 1697 c-61 -62 -112 -115 -112 -119 0 -20 201 -108 247 -108\n  10 0 13 34 13 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115\n  -113z"/>\n  <path d="M11033 1803 c-10 -3 -13 -47 -13 -169 0 -90 4 -164 8 -164 36 0 186\n  61 239 98 16 10 -216 242 -234 235z"/>\n  </g>\n  </svg>\n`,n=t=>`\n  <div class="car-buttons">\n    <button class="button car-buttons__select" data-select-id=${t.id}>Select</button>\n    <button class="button car-buttons__remove" data-remove-id=${t.id}>Remove</button>\n    <span class="car-name">${t.name}</span>\n  </div>\n  <div class="racetrack">\n    <div class="car-controls">\n      <div class="start-stop-car">\n        <button class="button start-stop-car__start-button" data-start-id=${t.id}>A</button>\n        <button class="button start-stop-car__stop-button" data-stop-id=${t.id} disabled>B</button>\n      </div>\n      <div class="car">\n        <div class="car-animation" data-car-animation-id=${t.id}>\n          ${e(t.color)}\n        </div>\n      </div>\n    </div>\n    <div class="flag">⚑</div>\n  </div>\n`,a=(t,e,a=1)=>`\n  <h2 class="count-car">Garage (${e})</h2>\n  <h3 class="page" data-page-id=${a}>Page #${a}</h3>\n  <ul class="garage">\n    ${t.map((t=>`\n      <li class="garage__car" data-car-id="${t.id}">${n(t)}</li>\n    `)).join("")}\n  </ul>\n`;class s{constructor(){this.renderStartPage=(t,e)=>{this.header.insertAdjacentHTML("afterbegin",'\n  <h1>async-race</h1>\n  <div class="main-buttons">\n    <button class="button main-button__garage">To garage</button>\n    <button class="button main-button__winners">To winners</button>\n  </div>\n  <div class="winners hidden"></div>\n  <div class="popup"></div>\n  <div class="create-edit-form">\n    <form class="create-form">\n      <input class="create-form__input" name="car-name" type="text">\n      <input class="create-form__color" name="car-color" type="color" value="#ffffff">\n      <button class="button create-form__button" type="submit">Create</button>\n    </form>\n    <form class="edit-form">\n      <input class="edit-form__input" name="car-name" type="text">\n      <input class="edit-form__color" name="car-color" type="color" value="#ffffff">\n      <button class="button edit-form__button" type="submit" disabled>Update</button>\n    </form>\n    <div class="controls">\n      <button class="button controls__button-race">Race</button>\n      <button class="button controls__button-reset" disabled>Reset</button>\n      <button class="button controls__button-generator">Generate cars</button>\n    </div>\n  </div>\n'),this.main.insertAdjacentHTML("afterbegin",a(t,e)),this.paginationGarage.insertAdjacentHTML("afterbegin",'\n<div class="pagination-garage">\n  <button class="button pagination-garage__prev" disabled>Prev</button>\n  <button class="button pagination-garage__next" disabled>Next</button>\n</div>\n'),this.paginationWinners.insertAdjacentHTML("afterbegin",'\n<div class="pagination-winners hidden">\n  <button class="button pagination-winners__prev" disabled>Prev</button>\n  <button class="button pagination-winners__next" disabled>Next</button>\n</div>\n'),this.footer.insertAdjacentHTML("afterbegin",'\n<div class="footer-year">2022</div>\n<div>\n    <a class="footer-github" href="https://github.com/dab10">github</a>\n</div>\n<a href="https://rs.school/js/">\n    <div class="footer-rss-image"></div>\n</a>\n'),document.body.append(this.header,this.paginationWinners,this.main,this.paginationGarage),document.body.append(this.footer);const n=document.querySelector(".pagination-garage__next");Number(e)>7&&(n.disabled=!1)},this.renderCurrentCar=(t,e)=>{if(e){const a=document.querySelector(`[data-car-id="${e}"]`);a&&(a.innerHTML="",a.innerHTML=n(t))}this.main.append(n(t))},this.disableButtonRace=t=>{document.querySelector(".create-form__button").disabled=t,document.querySelector(".controls__button-race").disabled=t,document.querySelector(".controls__button-generator").disabled=t,document.querySelectorAll(".car-buttons__select,  .car-buttons__remove").forEach((e=>{e.disabled=t}));const e=document.querySelector(".pagination-garage__prev"),n=document.querySelector(".pagination-garage__next"),a=document.querySelector(".edit-form__button"),s=document.querySelector(".controls__button-reset");t&&(this.isRaceButtonPrev=e.disabled,this.isRaceButtonNext=n.disabled,this.isRaceButtonUpdate=a.disabled,this.isRaceButtonReset=s.disabled),e.disabled=t,n.disabled=t,a.disabled=t,t||(e.disabled=this.isRaceButtonPrev,n.disabled=this.isRaceButtonNext,a.disabled=this.isRaceButtonUpdate,s.disabled=this.isRaceButtonReset)},this.disableEnableButtonCar=t=>{document.querySelector(".create-form__button").disabled=t,document.querySelector(".edit-form__button").disabled=t,document.querySelector(".controls__button-race").disabled=t,document.querySelector(".controls__button-reset").disabled=t,document.querySelector(".controls__button-generator").disabled=t,document.querySelectorAll(".car-buttons__select,  .car-buttons__remove").forEach((e=>{e.disabled=t}));const e=document.querySelector(".pagination-garage__prev"),n=document.querySelector(".pagination-garage__next");t&&(this.isRaceButtonPrev=e.disabled,this.isRaceButtonNext=n.disabled),e.disabled=t,n.disabled=t,t||(e.disabled=this.isRaceButtonPrev,n.disabled=this.isRaceButtonNext)},this.header=document.createElement("header"),this.header.classList.add("header"),this.main=document.createElement("main"),this.main.classList.add("main"),this.paginationGarage=document.createElement("div"),this.paginationWinners=document.createElement("div"),this.footer=document.createElement("footer"),this.isStarted=!1,this.isRaceButtonNext=!1,this.isRaceButtonPrev=!1,this.isRaceButtonUpdate=!1,this.isRaceButtonReset=!1}static renderStartTableWinners(t,n,a=1){const s=document.querySelector(".winners");s&&(s.innerHTML=""),s.innerHTML=((t,n,a=1)=>`\n    <h2 class="count-winners">Winners (${n})</h2>\n    <h3 class="page-winners" data-page-winners-id=${a}>Page #${a}</h3>\n    <table class="table-winners">\n      <thead>\n        <th>Number</th>\n        <th>Car</th>\n        <th>Name</th>\n        <th class="sort-by-wins">\n          <span>Wins</span>\n          <span class="sort-by-wins_asc">↑</span>\n          <span class="sort-by-wins_desc">↓</span>\n        </th>\n        <th class="sort-by-time">\n          Best time (seconds)\n          <span class="sort-by-time_asc">↑</span>\n          <span class="sort-by-time_desc">↓</span>\n        </th>\n      </thead>\n      <tbody>\n        ${t.map(((t,n)=>`\n          <tr>\n            <td>${n+10*(a-1)+1}</td>\n            <td>${e(String(t.car.color))}</td>\n            <td>${t.car.name}</td>\n            <td>${t.wins}</td>\n            <td>${Math.floor(100*t.time)/100}</td>\n          </tr>\n        `)).join("")}\n      </tbody>\n    </table>\n`)(t,n,a);const i=document.querySelector(".pagination-winners__next"),r=document.querySelector(".pagination-winners__prev");1===a&&(r.disabled=!0),Number(n)>10&&(i.disabled=!1)}static changePage(t){const e=document.querySelector(".main"),n=document.querySelector(".pagination-garage"),a=document.querySelector(".create-edit-form"),s=document.querySelector(".pagination-winners"),i=document.querySelector(".winners");t.target.classList.contains("main-button__garage")?(e.classList.remove("hidden"),n.classList.remove("hidden"),a.classList.remove("hidden"),s.classList.add("hidden"),i.classList.add("hidden")):(e.classList.add("hidden"),n.classList.add("hidden"),a.classList.add("hidden"),s.classList.remove("hidden"),i.classList.remove("hidden"))}static popupHidden(){document.querySelector(".popup").classList.add("hidden")}static enableStartButton(t){document.querySelectorAll(".start-stop-car__start-button").forEach((e=>{e.disabled=t}))}}s.deleteCar=(t,e)=>{const n=document.querySelector(".count-car"),a=document.querySelector(`[data-car-id="${t}"]`);n.innerHTML="",n.innerHTML=`Garage (${e})`,a.remove()},s.renderNewCars=(t,e,n)=>{const s=document.querySelector(".main");s.innerHTML="",s.innerHTML=a(t,e,n)},s.renderPageNumber=t=>{const e=document.querySelector(".page");e.innerHTML="",e.innerHTML=`Page #${t}`},s.renderPopup=(t,e)=>{const n=document.querySelector(".popup");n.classList.remove("hidden"),n.textContent="",n.textContent=`${t} win (${Math.floor(100*e)/100}s)! (tap to close or press reset)`},s.disableStartStopButtonRace=t=>{document.querySelectorAll(".start-stop-car__start-button").forEach((e=>{e.disabled=t})),document.querySelectorAll(".start-stop-car__stop-button").forEach((e=>{e.disabled=t}))},s.enableStartButtonRace=t=>{document.querySelector(`[data-start-id="${t}"]`).disabled=!1};const i=s;const r=class{constructor(){this.getCars=async(t,e=this.carsPerPage)=>{const n=await fetch(`${this.garage}?_page=${t}&_limit=${e}`);return{items:await n.json(),count:n.headers.get("X-Total-Count")}},this.getCar=async t=>(await fetch(`${this.garage}/${t}`)).json(),this.createCar=async t=>(await fetch(this.garage,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json(),this.deleteCar=async t=>(await fetch(`${this.garage}/${t}`,{method:"DELETE"})).json(),this.updateCar=async(t,e)=>(await fetch(`${this.garage}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json(),this.startEngine=async t=>(await fetch(`${this.engine}?id=${t}&status=started`,{method:"PATCH"})).json(),this.stopEngine=async t=>(await fetch(`${this.engine}?id=${t}&status=stopped`,{method:"PATCH"})).json(),this.drive=async e=>{try{return(await fetch(`${this.engine}?id=${e}&status=drive`,{method:"PATCH",signal:this.controller.signal})).status===t.Success?{success:!0}:{success:!1}}catch{return{success:!0}}},this.getSortOrder=(t,e)=>t&&e?(this.sortAndOrder=`&_sort=${t}&_order=${e}`,this.sortAndOrder):(this.sortAndOrder="",this.sortAndOrder),this.getWinners=async({page:t,limit:e=this.winnersPerPage,sort:n,order:a})=>{const s=await fetch(`${this.winners}?_page=${t}&_limit=${e}${this.getSortOrder(n,a)}`),i=await s.json();return{items:await Promise.all(i.map((async t=>({...t,car:await this.getCar(t.id)})))),count:s.headers.get("X-Total-Count")}},this.getWinner=async t=>(await fetch(`${this.winners}/${t}`)).json(),this.getWinnerStatus=async t=>(await fetch(`${this.winners}/${t}`)).status,this.deleteWinner=async t=>(await fetch(`${this.winners}/${t}`,{method:"DELETE"})).json(),this.createWinner=async t=>(await fetch(this.winners,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json(),this.updateWinner=async(t,e)=>(await fetch(`${this.winners}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json(),this.saveWinner=async({id:e,time:n})=>{if(await this.getWinnerStatus(e)===t.NotFound)await this.createWinner({id:e,wins:1,time:n});else{const t=await this.getWinner(e);await this.updateWinner(e,{id:e,wins:t.wins+1,time:n<t.time?n:t.time})}},this.base="http://localhost:3000",this.garage=`${this.base}/garage`,this.engine=`${this.base}/engine`,this.winners=`${this.base}/winners`,this.sortAndOrder="",this.view=new i,this.controller=new AbortController,this.startPageGarage=1,this.startPageWinners=1,this.carsPerPage=7,this.winnersPerPage=10}async carsForStartPage(){const{items:t,count:e}=await this.getCars(this.startPageGarage);this.view.renderStartPage(t,e)}async winnersForStartPage(){const{items:t,count:e}=await this.getWinners({page:this.startPageWinners,limit:this.winnersPerPage,sort:"",order:""});i.renderStartTableWinners(t,e)}};const o=class extends r{constructor(){super(),this.generateRandomName=()=>`${this.carBrand[Math.floor(Math.random()*this.carBrand.length)]} ${this.carModel[Math.floor(Math.random()*this.carModel.length)]}`,this.generateRandomColor=()=>{let t="#";for(let e=0;e<6;e+=1)t+=this.letters[Math.floor(Math.random()*this.letters.length)];return t},this.generateCars=async()=>{const t=document.querySelector(".pagination-garage__next"),e=document.querySelector(".page").getAttribute("data-page-id"),n=Number(e),a=(t=>new Array(t).fill(1).map((()=>({name:this.generateRandomName(),color:this.generateRandomColor()}))))(100);console.log(a),a.map((async t=>{await this.createCar({name:t.name,color:t.color,id:0})}));const{items:s,count:r}=await this.getCars(Number(n));i.renderNewCars(s,r,Number(n)),t.disabled=!1},this.view=new i,this.id="",this.currentPage=1,this.carBrand=["Hyundai","Lada","Kia","Toyota","Ford","Tesla","BMW","Mercedes","Honda","Renault","Peugeot"],this.carModel=["Solaris","Granta","Rio","Vesta","Creta","Camry","RAV4","F-Series","Model S","WR-V","Clio","308"],this.letters="0123456789ABCDEF"}async editCar(t){if(this.id=t.target.getAttribute("data-select-id"),this.id){const t=document.querySelector(".edit-form"),e=document.querySelector(".edit-form__input"),n=document.querySelector(".edit-form__color"),a=document.querySelector(".edit-form__button");e.style.pointerEvents="auto",n.style.pointerEvents="auto",a.disabled=!1;const s=async t=>{t.preventDefault(),console.log(e,n);const s=e.value,i=n.value;await this.updateCar(Number(this.id),{name:s,color:i});const r=await this.getCar(Number(this.id));this.view.renderCurrentCar(r,Number(this.id)),e.style.pointerEvents="none",n.style.pointerEvents="none",a.disabled=!0,this.winnersForStartPage()};t.addEventListener("submit",(t=>s(t)))}}async createNewCar(t){t.preventDefault();const e=document.querySelector(".pagination-garage__next"),n=document.querySelector(".create-form__input"),a=document.querySelector(".create-form__color"),s=document.querySelector(".page").getAttribute("data-page-id"),r=n.value,o=a.value;await this.createCar({name:r,color:o,id:0});const{items:c,count:d}=await this.getCars(Number(s));i.renderNewCars(c,d,Number(s)),Number(d)%7==1&&1!==Number(d)&&(e.disabled=!1)}async removeCar(t){const e=document.querySelector(".pagination-garage__next"),n=document.querySelector(".pagination-garage__prev"),a=document.querySelector(".edit-form__input"),s=document.querySelector(".edit-form__color"),r=document.querySelector(".edit-form__button"),o=document.querySelector(".page").getAttribute("data-page-id");let c=Number(o);const d=t.target.getAttribute("data-remove-id");if(d){await this.deleteCar(Number(d));const{count:t}=await this.getCars(c);Number(t)/7+1===c&&(c-=1);const{items:a}=await this.getCars(c);i.renderNewCars(a,t,c),7===Number(t)&&(e.disabled=!0,n.disabled=!0)}!1===r.disabled&&(a.style.pointerEvents="none",s.style.pointerEvents="none",r.disabled=!0),await this.deleteWinner(Number(d)),await this.winnersForStartPage()}};const c=class extends r{constructor(){super(...arguments),this.moveNext=async()=>{const t=document.querySelector(".pagination-garage__next"),e=document.querySelector(".pagination-garage__prev"),n=document.querySelector(".page").getAttribute("data-page-id");let a=Number(n);a+=1;const{items:s,count:r}=await this.getCars(a);i.renderNewCars(s,r,a),a>1&&(e.disabled=!1),a===Math.ceil(Number(r)/7)&&(t.disabled=!0)},this.movePrev=async()=>{const t=document.querySelector(".pagination-garage__next"),e=document.querySelector(".pagination-garage__prev"),n=document.querySelector(".page").getAttribute("data-page-id");let a=Number(n);a-=1;const{items:s,count:r}=await this.getCars(a);i.renderNewCars(s,r,a),1===a&&(e.disabled=!0),a<=Math.floor(Number(r)/7)&&(t.disabled=!1)},this.moveNextWinners=async()=>{const t=document.querySelector(".pagination-winners__next"),e=document.querySelector(".pagination-winners__prev"),n=document.querySelector(".page-winners").getAttribute("data-page-winners-id");let a=Number(n);a+=1;const{items:s,count:r}=await this.getWinners({page:a,limit:10,sort:"wins",order:"asc"});i.renderStartTableWinners(s,r,a),a>1&&(e.disabled=!1),a===Math.ceil(Number(r)/10)&&(t.disabled=!0)},this.movePrevWinners=async()=>{const t=document.querySelector(".pagination-winners__next"),e=document.querySelector(".pagination-winners__prev"),n=document.querySelector(".page-winners").getAttribute("data-page-winners-id");let a=Number(n);a-=1;const{items:s,count:r}=await this.getWinners({page:a,limit:10,sort:"wins",order:"asc"});i.renderStartTableWinners(s,r,a),1===a&&(e.disabled=!0),a<=Math.floor(Number(r)/10)&&(t.disabled=!1)}}};const d=class extends r{constructor(){super(),this.animatePosition=async t=>{this.count<1&&(this.count=0),this.countAnimation+=1;const e=t.target.getAttribute("data-start-id");t.target.disabled=!0;if(document.querySelector(`[data-stop-id="${e}"]`).disabled=!1,1===this.countAnimation&&this.view.disableButtonRace(!0),e){const t=document.querySelector(`[data-car-animation-id="${e}"]`),{velocity:n,distance:a}=await this.startEngine(Number(e)),s=t.offsetLeft,i=a/n/1e3*60;console.log(n);const r=(window.innerWidth-140-t.offsetLeft)/i;this.animation[e]=this.animationScreen(t,s,r,e);const{success:o}=await this.drive(Number(e));o||window.cancelAnimationFrame(this.animation[e])}},this.animationScreen=(t,e,n,a)=>{let s=e;const i=t,r=()=>{s+=n,i.style.transform=`translateX(${s}px)`,s<window.innerWidth-140&&(this.animation[a]=window.requestAnimationFrame(r))};return this.animation[a]=window.requestAnimationFrame(r),this.animation[a]},this.animateStop=async t=>{this.countAnimation-=1,this.count<1&&(this.count=1);const e=t.target.getAttribute("data-stop-id"),n=document.querySelector(`[data-car-animation-id="${e}"]`),a=document.querySelector(`[data-stop-id="${e}"]`),s=document.querySelector(`[data-start-id="${e}"]`);a.disabled=!0,await this.stopEngine(Number(e)),n.style.transform="translateX(0)",window.cancelAnimationFrame(this.animation[Number(e)]),s.disabled=!1,0===this.countAnimation&&this.view.disableButtonRace(!1),this.controller.abort(),this.controller=new AbortController},this.raceAll=async()=>{this.allCars=[],this.timesFinishCar=[];document.querySelectorAll(".garage__car").forEach((t=>this.allCars.push(t.getAttribute("data-car-id")))),this.view.disableButtonRace(!0),console.log(this.allCars),await Promise.race(this.allCars.map((async t=>{this.count=0,i.disableStartStopButtonRace(!0);const e=document.querySelector(`[data-car-animation-id="${t}"]`),{velocity:n,distance:a}=await this.startEngine(Number(t)),s=e.offsetLeft,r=a/n/1e3,o=a/n/1e3*60;console.log(n,t);const c=(window.innerWidth-140-e.offsetLeft)/o;this.animation[t]=this.animationScreen(e,s,c,t);const{success:d}=await this.drive(Number(t));d||window.cancelAnimationFrame(this.animation[t]),d&&this.timesFinishCar.push({time:r,id:Number(t),isSuccess:d}),this.winnerResult(this.timesFinishCar,this.allCars)}))),console.log(this.allCars),console.log(this.timesFinishCar)},this.winnerResult=async(t,e)=>{if(0!==t.length&&(this.count+=1,console.log("!!!",this.count),1===this.count)){console.log(t);const e=t.filter((t=>!0===t.isSuccess));if(console.log(e),0!==e.length){const t=e.reduce(((t,e)=>t.time<e.time?t:e));console.log(t),await this.saveWinner({id:t.id,time:t.time});const{name:n}=await this.getCar(t.id);i.renderPopup(n,t.time),await this.winnersForStartPage()}document.querySelector(".controls__button-reset").disabled=!1}0===this.count&&2===e.length&&(console.log("!!!!!! broke"),document.querySelector(".controls__button-reset").disabled=!1)},this.raceReset=async()=>{this.allCars.map((async t=>{const e=document.querySelector(`[data-car-animation-id="${t}"]`);await this.stopEngine(Number(t)),e.style.transform="translateX(0)",window.cancelAnimationFrame(this.animation[Number(t)]),this.controller.abort(),this.controller=new AbortController;document.querySelector(".popup").classList.add("hidden")})),document.querySelector(".controls__button-reset").disabled=!0,setTimeout((()=>this.view.disableButtonRace(!1)),3e3),setTimeout((()=>i.enableStartButton(!1)),3e3)},this.animation={},this.allCars=[],this.timesFinishCar=[],this.res=[],this.count=0,this.countAnimation=0}};const l=class extends r{constructor(){super(...arguments),this.sorting=async(t,e)=>{const n=document.querySelector(".pagination-winners__next"),a=document.querySelector(".page-winners").getAttribute("data-page-winners-id"),s=Number(a),{items:r,count:o}=await this.getWinners({page:s,limit:10,sort:t,order:e});console.log(r),i.renderStartTableWinners(r,o,s),Number(o)%10==1&&1!==Number(o)&&(n.disabled=!1),Math.ceil(Number(o)/10)===s&&(n.disabled=!0)}}};(new class{constructor(){this.animation=new d,this.api=new r,this.editCar=new o,this.pagination=new c,this.tableWinners=new l}async start(){await this.api.carsForStartPage(),await this.api.winnersForStartPage();const t=document.querySelector(".main"),e=document.querySelector(".winners"),n=document.querySelector(".create-form__button"),a=document.querySelector(".pagination-garage__next"),s=document.querySelector(".pagination-garage__prev"),r=document.querySelector(".controls__button-race"),o=document.querySelector(".controls__button-reset"),c=document.querySelector(".main-button__garage"),d=document.querySelector(".main-button__winners"),l=document.querySelector(".popup"),u=document.querySelector(".controls__button-generator"),h=document.querySelector(".pagination-winners__next"),m=document.querySelector(".pagination-winners__prev");t.addEventListener("click",(t=>this.listenButtonsCar(t))),n.addEventListener("click",(t=>this.editCar.createNewCar(t))),a.addEventListener("click",this.pagination.moveNext),s.addEventListener("click",this.pagination.movePrev),h.addEventListener("click",this.pagination.moveNextWinners),m.addEventListener("click",this.pagination.movePrevWinners),r.addEventListener("click",this.animation.raceAll),o.addEventListener("click",this.animation.raceReset),d.addEventListener("click",(t=>i.changePage(t))),c.addEventListener("click",(t=>i.changePage(t))),l.addEventListener("click",i.popupHidden),e.addEventListener("click",(t=>this.listenButtonsSortingTable(t))),u.addEventListener("click",this.editCar.generateCars)}listenButtonsCar(t){t.target.classList.contains("start-stop-car__start-button")&&this.animation.animatePosition(t),t.target.classList.contains("start-stop-car__stop-button")&&this.animation.animateStop(t),t.target.classList.contains("car-buttons__select")&&this.editCar.editCar(t),t.target.classList.contains("car-buttons__remove")&&this.editCar.removeCar(t)}listenButtonsSortingTable(t){t.target.classList.contains("sort-by-wins_asc")&&this.tableWinners.sorting("wins","asc"),t.target.classList.contains("sort-by-wins_desc")&&this.tableWinners.sorting("wins","desc"),t.target.classList.contains("sort-by-time_asc")&&this.tableWinners.sorting("time","asc"),t.target.classList.contains("sort-by-time_desc")&&this.tableWinners.sorting("time","desc")}}).start()})();